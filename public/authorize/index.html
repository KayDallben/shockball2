<script
  src="http://code.jquery.com/jquery-2.2.4.min.js"
  integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
  crossorigin="anonymous"></script>

<script>
  $(document).ready(function() {
    function getParameterByName(name, url) {
      if (!url) url = window.location.href;
      name = name.replace(/[\[\]]/g, "\\$&");
      var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
          results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    function returnToDocs() {
      var url = window.location.protocol + "//" + window.location.host + "/";
      window.location.href = url;
    }

    function getAuthorizationCode() {
      var existingAuthorizationCode = sessionStorage.getItem("swcAuthorizationCode");
      if (existingAuthorizationCode) {
        //we have our authorization code but not our access token, so get access token from my api
        getAccessToken(existingAuthorizationCode)
      } else {
        //we don't have the authorization code, grab it from querystring params
        var authorizationCode = getParameterByName('code');
        sessionStorage.setItem("swcAuthorizationCode", authorizationCode.toString())
        getAccessToken(authorizationCode)
      }
    }

    function getAccessToken(authCode) {
      var url = window.location.protocol + "//" + window.location.host + "/";
      var settings = {
        "async": true,
        "crossDomain": true,
        "url": url + "api/login?authorization_code=" + authCode,
        "method": "GET"
      }

      $.ajax(settings).done(function (response) {
        sessionStorage.setItem('swcAccessToken', response.access_token)
        sessionStorage.setItem('swcAccessTokenExpiresIn', response.expires_in)
        sessionStorage.setItem('swcRefreshToken', response.refresh_token)
        returnToDocs()
      });
    }

    //we try to get/set token anytime this page loads
    getAuthorizationCode();
  });
</script>


<div>This is the authorize page.</div>