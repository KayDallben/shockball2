{"version":3,"sources":["../../src/controllers/accountController.js"],"names":["AccountController","db","logger","accounts","collection","req","res","validation","validate","params","listOneParams","error","doc","id","get","then","userAccount","data","transactions","getCollections","collections","forEach","snapshot","push","status","send","listParams","length","name","message"],"mappings":";;;;;;qjBAAA;;;AAGA;;;AAFA;;;;AAGA;;;;;;;;;;IAEMA,iB;AAEJ,6BAAYC,EAAZ,EAAgBC,MAAhB,EAAwB;AAAA;;AACtB,SAAKC,QAAL,GAAgBF,GAAGG,UAAH,CAAc,UAAd,CAAhB;AACA,SAAKF,MAAL,GAAcA,MAAd;AACD;;;;;2FAEaG,G,EAAKC,G;;;;;;;;AACXC,0B,GAAa,cAAIC,QAAJ,CAAaH,IAAII,MAAjB,EAAyB,kBAAcC,aAAvC,C;;sBACfH,WAAWI,KAAX,KAAqB,I;;;;;;;uBAEf,KAAKR,QAAL,CAAcS,GAAd,CAAkBP,IAAII,MAAJ,CAAWI,EAA7B,EAAiCC,GAAjC,GAAuCC,IAAvC;AAAA,sFAA4C,iBAAOH,GAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAC5CI,uCAD4C,GAC9BJ,IAAIK,IAAJ,EAD8B;;AAEhDD,wCAAYE,YAAZ,GAA2B,EAA3B;AAFgD;AAAA,mCAG1C,MAAKf,QAAL,CAAcS,GAAd,CAAkBP,IAAII,MAAJ,CAAWI,EAA7B,EAAiCM,cAAjC,GAAkDJ,IAAlD,CAAuD,uBAAe;AAC1EK,0CAAYC,OAAZ,CAAoB,sBAAc;AAChCjB,2CAAWU,GAAX,GAAiBC,IAAjB,CAAsB,oBAAY;AAChCO,2CAASD,OAAT,CAAiB,UAACT,GAAD,EAAS;AACxBI,gDAAYE,YAAZ,CAAyBK,IAAzB,CAA8BX,IAAIK,IAAJ,EAA9B;AACD,mCAFD;AAGAX,sCAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBT,WAArB;AACD,iCALD;AAMD,+BAPD;AAQD,6BATK,CAH0C;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAA5C;;AAAA;AAAA;AAAA;AAAA,oB;;;;;;;;;;AAeN,qBAAKd,MAAL,CAAYS,KAAZ;AACAL,oBAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB;;;;;;;AAGF,qBAAKvB,MAAL,CAAYS,KAAZ,CAAkB,2BAA2BJ,WAAWI,KAAxD;AACAL,oBAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBlB,WAAWI,KAAhC;;;;;;;;;;;;;;;;;;;4FAION,G,EAAKC,G;;;;;;AACRC,0B,GAAa,cAAIC,QAAJ,CAAaH,IAAII,MAAjB,EAAyB,kBAAciB,UAAvC,C;;sBACfnB,WAAWI,KAAX,KAAqB,I;;;;;;;uBAEf,KAAKR,QAAL,CAAcW,GAAd,GAAoBC,IAApB,CAAyB,UAACO,QAAD,EAAc;AAC3C,sBAAInB,WAAW,EAAf;AACAmB,2BAASD,OAAT,CAAiB,UAACT,GAAD,EAAS;AACxBT,6BAASoB,IAAT,CAAcX,IAAIK,IAAJ,EAAd;AACD,mBAFD;AAGA,sBAAId,SAASwB,MAAT,GAAkB,CAAC,CAAvB,EAA0B;AACxBrB,wBAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBtB,QAArB;AACD,mBAFD,MAEO;AACL,0BAAM;AACJyB,4BAAM,iBADF;AAEJC,+BAAS;AAFL,qBAAN;AAID;AACF,iBAbK,C;;;;;;;;;;AAeN,qBAAK3B,MAAL,CAAYS,KAAZ;AACAL,oBAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB;;;;;;;AAGF,qBAAKvB,MAAL,CAAYS,KAAZ,CAAkB,2BAA2BJ,WAAWI,KAAxD;AACAL,oBAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBlB,WAAWI,KAAhC;;;;;;;;;;;;;;;;;;;;;kBAMSX,iB","file":"accountController.js","sourcesContent":["//third party\r\nimport Joi from 'joi'\r\n\r\n//internal\r\nimport AccountSchema from '../models/Account.js'\r\n\r\nclass AccountController {\r\n\r\n  constructor(db, logger) {\r\n    this.accounts = db.collection('accounts')\r\n    this.logger = logger\r\n  }\r\n\r\n  async listOne(req, res) {\r\n    const validation = Joi.validate(req.params, AccountSchema.listOneParams)\r\n    if (validation.error === null) {\r\n      try {\r\n        await this.accounts.doc(req.params.id).get().then(async (doc) => {\r\n          let userAccount = doc.data()\r\n          userAccount.transactions = []\r\n          await this.accounts.doc(req.params.id).getCollections().then(collections => {\r\n            collections.forEach(collection => {\r\n              collection.get().then(snapshot => {\r\n                snapshot.forEach((doc) => {\r\n                  userAccount.transactions.push(doc.data())\r\n                })\r\n                res.status(200).send(userAccount)\r\n              })\r\n            })\r\n          })\r\n        })\r\n      } catch (error) {\r\n        this.logger.error(error)\r\n        res.status(400).send(error)\r\n      }\r\n    } else {\r\n      this.logger.error('Joi validation error: ' + validation.error)\r\n      res.status(400).send(validation.error)\r\n    }\r\n  }\r\n\r\n  async list(req, res) {\r\n    const validation = Joi.validate(req.params, AccountSchema.listParams)\r\n    if (validation.error === null) {\r\n      try {\r\n        await this.accounts.get().then((snapshot) => {\r\n          let accounts = []\r\n          snapshot.forEach((doc) => {\r\n            accounts.push(doc.data())\r\n          })\r\n          if (accounts.length > -1) {\r\n            res.status(200).send(accounts)\r\n          } else {\r\n            throw {\r\n              name: 'NoAccountsExist',\r\n              message: 'There were no accounts found in the database for this query!'\r\n            }\r\n          }\r\n        })\r\n      } catch (error) {\r\n        this.logger.error(error)\r\n        res.status(400).send(error)\r\n      }\r\n    } else {\r\n      this.logger.error('Joi validation error: ' + validation.error)\r\n      res.status(400).send(validation.error)\r\n    }\r\n  }\r\n\r\n}\r\n\r\nexport default AccountController"]}