{"version":3,"sources":["../../src/controllers/playerController.js"],"names":["util","PlayerController","db","logger","players","collection","teams","events","contracts","req","res","query","queryProp","queryVal","validation","Joi","validate","params","PlayerSchema","listParams","error","get","then","snapshot","forEach","doc","push","data","length","status","send","name","message","searchValidation","listSearchParams","where","id","updateParams","updateSet","lineupPosition","regimen","JSON","parse","update","_writeTime","doc2","errorMessage","listOneParams","playerData","teamData","contractData","records","teamUid","contractUid","doc3","shockballPlayerUid","doc4","generateSummaryRecords","season","matches","goals","shots","passes","blocksPass","blocksShot","tackles","runsBall","goalAverage"],"mappings":"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","file":"playerController.js","sourcesContent":["//third party\nimport Joi from 'joi'\n\n//internal\nimport PlayerSchema from '../models/Player.js'\nimport * as util from '../lib/util.js'\n\nclass PlayerController {\n\n  constructor(db, logger) {\n    this.players = db.collection('players')\n    this.teams = db.collection('teams')\n    this.events = db.collection('events')\n    this.contracts = db.collection('contracts')\n    this.logger = logger\n  }\n\n  async list(req, res) {\n    if (!req.query.queryProp && !req.query.queryVal) {\n      const validation = Joi.validate(req.params, PlayerSchema.listParams)\n      if (validation.error === null) {\n        try {\n          await this.players.get().then((snapshot) => {\n            let players = []\n            snapshot.forEach((doc) => {\n              players.push(doc.data())\n            })\n            if (players.length > -1) {\n              res.status(200).send(players)\n            } else {\n              throw {\n                name: 'NoPlayersExist',\n                message: 'There were no players found in the database for this query!'\n              }\n            }\n          })\n        } catch (error) {\n          this.logger.error(error)\n          res.status(400).send(error)\n        }\n      } else {\n        this.logger.error('Joi validation error: ' + validation.error)\n        res.status(400).send(validation.error)\n      }\n    } else {\n      //we are searching for players by criteria\n      const searchValidation = Joi.validate(req.query, PlayerSchema.listSearchParams)\n      if (searchValidation.error === null) {\n        try {\n          await this.players.where(req.query.queryProp, '==', req.query.queryVal).get().then((snapshot) => {\n            let players = []\n            snapshot.forEach((doc) => {\n              players.push(doc.data())\n            })\n            if (players.length > -1) {\n              res.status(200).send(players)\n            } else {\n              throw {\n                name: 'NoPlayersExist',\n                message: 'There were no players found in the database for this query!'\n              }\n            }\n          })\n        } catch (error) {\n          this.logger.error(error)\n          res.status(400).send(error)\n        }\n      } else {\n        this.logger.error('Joi validation error: ' + searchValidation.error)\n        res.status(400).send(searchValidation.error)\n      }\n    }\n  }\n\n  async update(req, res) {\n    const {id} = req.params\n    const validation = Joi.validate(req.query, PlayerSchema.updateParams)\n    if (validation.error === null) {\n      try {\n        let updateSet = {}\n        if (req.query.lineupPosition) {\n          updateSet = {\n            lineupPosition: req.query.lineupPosition === 'null' ? null : req.query.lineupPosition\n          }\n        } else {\n          updateSet = {\n            regimen: JSON.parse(req.query.regimen)\n          }\n        }\n        await this.players.doc(id).update(updateSet).then(async (doc) => {\n          if (doc._writeTime) {\n            await this.players.doc(id).get().then((doc2) => {\n              res.status(200).send(doc2.data())\n            })\n          } else {\n            const errorMessage = 'Failed to write update to player for training regimen.'\n            this.logger.error(errorMessage)\n            res.status(400).send(errorMessage)\n          }\n        })\n      } catch (error) {\n        this.logger.error(error)\n        res.status(400).send(error)\n      }\n    } else {\n      this.logger.error('Joi validation error: ' + validation.error)\n      res.status(400).send(validation.error)\n    }\n  }\n\n  async listOne(req, res) {\n    const validation = Joi.validate(req.params, PlayerSchema.listOneParams)\n    if (validation.error === null) {\n      try {\n        await this.players.doc(req.params.id).get().then(async(doc) => {\n          let playerData = doc.data()\n          playerData.teamData = {}\n          playerData.contractData = {}\n          playerData.records = []\n          if (playerData.teamUid && playerData.teamUid.length > 0) {\n            await this.teams.doc(playerData.teamUid).get().then((doc2) => {\n              playerData.teamData = doc2.data()\n            })\n          }\n          if (playerData.contractUid && playerData.contractUid.length > 0) {\n            await this.contracts.doc(playerData.contractUid).get().then((doc3) => {\n              playerData.contractData = doc3.data()\n            })\n          }\n          await this.events.where('actorUid', '==', playerData.shockballPlayerUid).get().then((snapshot) => {\n            let events = []\n            snapshot.forEach((doc4) => {\n              events.push(doc4.data())\n            })\n            if (events.length > 0) {\n              playerData.records = util.generateSummaryRecords(events)\n            } else {\n              playerData.records = [{\n                season: '1',\n                matches: 0,\n                goals: 0,\n                shots: 0,\n                passes: 0,\n                blocksPass: 0,\n                blocksShot: 0,\n                tackles: 0,\n                runsBall: 0,\n                goalAverage: 0\n              }]\n            }\n          })\n          res.status(200).send(playerData)\n        })\n      } catch (error) {\n        this.logger.error(error)\n        res.status(400).send(error)\n      }\n    } else {\n      this.logger.error('Joi validation error: ' + validation.error)\n      res.status(400).send(validation.error)\n    }\n  }\n}\n\nexport default PlayerController"]}