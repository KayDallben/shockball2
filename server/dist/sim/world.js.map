{"version":3,"sources":["../../src/sim/world.js"],"names":["util","World","objects","leftPlayers","leftBench","Center","Wing","Guard","Sub","Inactive","rightPlayers","rightBench","object","getType","push","filter","worldObject","shockballPlayerUid","homeGoalSide","leftPlayer","rightPlayer","challenge","rechargeBenchPlayerEnergy","rotateIfEnergyThreshold","update","allLeftPlayers","concat","allRightPlayers","player","playerEnduranceModifier","endurance","energy","defaultThreshold","trySwapLinePlayer","gameTime","playerToSub","getNextRoleFromBench","role","subOutPlayer","subInPlayer","record","add","side","register","removeFromBench","addToField","playerDeregister","removeFromField","addToBench","benchPlayer","fieldedPlayer","ensureRole","playerRole","currentPlayer","undefined","sidePlayers","doesCenterExist","find","wings","doesGuardExist","length","oldRightPlayers","oldRightBench","oldLeftPlayers","oldLeftBench"],"mappings":"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","file":"world.js","sourcesContent":["import Util from './util'\r\nimport Player from './player'\r\n\r\nconst util = new Util()\r\n\r\nexport default class World {\r\n  constructor() {\r\n   this.objects = []\r\n   this.leftPlayers = []\r\n   this.leftBench = {\r\n     Center: [],\r\n     Wing: [],\r\n     Guard: [],\r\n     Sub: [],\r\n     Inactive: []\r\n   }\r\n   this.rightPlayers = []\r\n   this.rightBench = {\r\n    Center: [],\r\n    Wing: [],\r\n    Guard: [],\r\n    Sub: [],\r\n    Inactive: []\r\n   }\r\n  }\r\n\r\n  register(object) {\r\n    if (util.getType(object) === '[object Object]') {\r\n      this.objects.push(object)\r\n    }\r\n  }\r\n\r\n  playerDeregister(object) {\r\n    this.objects = this.objects.filter(function(worldObject) {\r\n      return worldObject.shockballPlayerUid !== object.shockballPlayerUid;\r\n    })\r\n    if (object.homeGoalSide === 'left') {\r\n      this.leftPlayers = this.leftPlayers.filter(function(leftPlayer) {\r\n        return leftPlayer.shockballPlayerUid !== object.shockballPlayerUid\r\n      })\r\n    } else {\r\n      this.rightPlayers = this.rightPlayers.filter(function(rightPlayer) {\r\n        return rightPlayer.shockballPlayerUid !== object.shockballPlayerUid\r\n      })\r\n    }\r\n  }\r\n\r\n  update(challenge) {\r\n    this.rechargeBenchPlayerEnergy()\r\n    this.rotateIfEnergyThreshold(challenge)\r\n    for (let worldObject of this.objects) {\r\n      if (worldObject.update) {\r\n        worldObject.update()\r\n      }\r\n    }\r\n  }\r\n\r\n  rechargeBenchPlayerEnergy() {\r\n    const allLeftPlayers = [].concat(this.leftBench.Center, this.leftBench.Wing, this.leftBench.Guard, this.leftBench.Sub, this.leftBench.Inactive)\r\n    const allRightPlayers = [].concat(this.rightBench.Center, this.rightBench.Wing, this.rightBench.Guard, this.rightBench.Sub, this.rightBench.Inactive)\r\n    for (let player of allLeftPlayers) {\r\n      const playerEnduranceModifier = player.endurance / 100\r\n      if (player.energy + (10 * playerEnduranceModifier) < 100) {\r\n        player.energy = player.energy + (10 * playerEnduranceModifier)\r\n      } else {\r\n        player.energy = 100\r\n      }\r\n    }\r\n    for (let player of allRightPlayers) {\r\n      const playerEnduranceModifier = player.endurance / 100\r\n      if (player.energy + (10 * playerEnduranceModifier) < 100) {\r\n        player.energy = player.energy + (10 * playerEnduranceModifier)\r\n      } else {\r\n        player.energy = 100\r\n      }\r\n    }\r\n  }\r\n\r\n  rotateIfEnergyThreshold(challenge) {\r\n    const defaultThreshold = 10\r\n    for (let player of this.leftPlayers) {\r\n      if (player.energy <= defaultThreshold) {\r\n        this.trySwapLinePlayer(player, challenge, this.objects[1].gameTime)\r\n      }\r\n    }\r\n    for (let player of this.rightPlayers) {\r\n      if (player.energy <= defaultThreshold) {\r\n        this.trySwapLinePlayer(player, challenge, this.objects[1].gameTime)\r\n      }\r\n    }\r\n  }\r\n\r\n  trySwapLinePlayer(player, challenge, gameTime) {\r\n    const playerToSub = this.getNextRoleFromBench(player.homeGoalSide, player.role)\r\n    if (playerToSub) {\r\n      //we only sub if there is a player on the bench to sub in!\r\n      this.subOutPlayer(player)\r\n      this.subInPlayer(playerToSub)\r\n      challenge.record.add(player, 'player rotation', gameTime)\r\n    }\r\n  }\r\n\r\n  getNextRoleFromBench(side, role) {\r\n    if (side === 'left') {\r\n      if (this.leftBench[role][0]) {\r\n        return this.leftBench[role][0]\r\n      }\r\n    } else {\r\n      if (this.rightBench[role][0]) {\r\n        return this.rightBench[role][0]\r\n      }\r\n    }\r\n  }\r\n\r\n  subInPlayer(player) {\r\n    this.register(player)\r\n    if (player.homeGoalSide === 'left') {\r\n      this.removeFromBench('left', player)\r\n      this.addToField('left', player)\r\n    } else {\r\n      this.removeFromBench('right', player)\r\n      this.addToField('right', player)\r\n    }\r\n  }\r\n\r\n  subOutPlayer(player) {\r\n    this.playerDeregister(player)\r\n    if (player.homeGoalSide === 'left') {\r\n      this.removeFromField('left', player)\r\n      this.addToBench('left', player)\r\n    } else {\r\n      this.removeFromField('right', player) \r\n      this.addToBench('right', player)\r\n    }\r\n  }\r\n\r\n  removeFromBench(side, player) {\r\n    if (side === 'left') {\r\n      this.leftBench[player.role] = this.leftBench[player.role].filter((benchPlayer) => {\r\n        return benchPlayer.shockballPlayerUid !== player.shockballPlayerUid\r\n      })\r\n    } else {\r\n      this.rightBench[player.role] = this.rightBench[player.role].filter((benchPlayer) => {\r\n        return benchPlayer.shockballPlayerUid !== player.shockballPlayerUid\r\n      })\r\n    }\r\n  }\r\n\r\n  removeFromField(side, player) {\r\n    if (side === 'left') {\r\n      this.leftPlayers = this.leftPlayers.filter((fieldedPlayer) => {\r\n        return fieldedPlayer.shockballPlayerUid !== player.shockballPlayerUid\r\n      })\r\n    } else {\r\n      this.rightPlayers = this.rightPlayers.filter((fieldedPlayer) => {\r\n        return fieldedPlayer.shockballPlayerUid !== player.shockballPlayerUid\r\n      })\r\n    }\r\n  }\r\n\r\n  addToField(side, player) {\r\n    player.role = this.ensureRole(side, player)\r\n    if (side === 'left') {\r\n      this.leftPlayers.push(player)\r\n    } else {\r\n      this.rightPlayers.push(player)\r\n    }\r\n  }\r\n\r\n  addToBench(side, player) {\r\n    const playerRole = player.role ? player.role : 'Inactive'\r\n    if (side === 'left') {\r\n      this.leftBench[playerRole].push(player)\r\n    } else {\r\n      this.rightBench[playerRole].push(player)\r\n    }\r\n  }\r\n\r\n  ensureRole(side, currentPlayer) {\r\n    let playerRole = currentPlayer.role\r\n    if (playerRole === undefined) {\r\n      const sidePlayers = side + 'Players'\r\n      const doesCenterExist = this[sidePlayers].find((player) => { return player.role === 'Center' })\r\n      const wings = this[sidePlayers].filter((player) => { return player.role === 'Wing' })\r\n      const doesGuardExist = this[sidePlayers].find((player) => { return player.role === 'Guard' })\r\n      if (!doesCenterExist) {\r\n        playerRole = 'Center'\r\n      } else if (!doesGuardExist) {\r\n        playerRole = 'Guard'\r\n      } else if (wings.length < 2) {\r\n        playerRole = 'Wing'\r\n      }\r\n    }\r\n    return playerRole\r\n  }\r\n\r\n  switchSides() {\r\n    const oldRightPlayers = this.rightPlayers\r\n    const oldRightBench = this.rightBench\r\n    const oldLeftPlayers = this.leftPlayers\r\n    const oldLeftBench = this.leftBench\r\n\r\n    this.rightPlayers = oldLeftPlayers\r\n    this.rightBench = oldLeftBench\r\n    this.leftPlayers = oldRightPlayers\r\n    this.leftBench = oldRightBench\r\n  }\r\n\r\n}"]}