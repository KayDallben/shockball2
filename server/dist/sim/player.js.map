{"version":3,"sources":["../../src/sim/player.js"],"names":["chance","util","Player","playerStats","world","challenge","homeGoalSide","getType","shockballPlayerUid","name","lineupPosition","image","teamUid","teamName","teamPicUrl","role","assignRoleFromLineup","passing","toughness","throwing","fatigue","endurance","vision","blocking","realWorldModel","playerWorldModel","objects","leftPlayers","rightPlayers","Error","applyEffects","think","takeAction","indexOf","undefined","gameObjects","pitch","push","board","ball","state","tryTackleBall","possessedBy","thinksHasScoreChance","analyzeCanScore","tryScore","thinksCanPass","analyzeCanPass","tryPass","tryRun","lastSideTouched","thinksMoreLikelyToShoot","actionGuess","analyzeNextAction","analyzeMoreLikelyToShoot","tryBlockShot","tryBlockPass","tryTacklePlayer","console","log","opposingPlayers","ballCarrier","find","player","rpg","sum","players","targetGoalResistence","goalResistence","goalPit","right","goalProximity","Math","abs","left","addTryScore","addTryPass","addTryRun","addTackleBall","addTryTacklePlayer"],"mappings":"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","file":"player.js","sourcesContent":["import Chance from 'chance'\r\nimport Util from './util'\r\nconst chance = new Chance()\r\nconst util = new Util()\r\n\r\nexport default class Player {\r\n  constructor(playerStats, world, challenge, homeGoalSide) {\r\n    if (util.getType(playerStats) === '[object Object]') {\r\n      this.shockballPlayerUid = playerStats.shockballPlayerUid\r\n      this.name = playerStats.name\r\n      this.lineupPosition = playerStats.lineupPosition\r\n      this.image = playerStats.image\r\n      this.teamUid = playerStats.teamUid\r\n      this.teamName = playerStats.teamName\r\n      this.teamPicUrl = playerStats.teamPicUrl\r\n      this.role = this.assignRoleFromLineup(playerStats.lineupPosition)\r\n      this.passing = playerStats.passing\r\n      this.toughness = playerStats.toughness\r\n      this.throwing = playerStats.throwing\r\n      this.fatigue = playerStats.fatigue\r\n      this.endurance = playerStats.endurance\r\n      this.vision = playerStats.vision\r\n      this.blocking = playerStats.blocking\r\n      this.homeGoalSide = homeGoalSide\r\n      this.challenge = challenge\r\n      this.realWorldModel = world\r\n      this.playerWorldModel = {\r\n        objects: [],\r\n        leftPlayers: [],\r\n        rightPlayers: []\r\n      }\r\n    } else {\r\n      throw new Error('Cannot create Player: incorrect param data types')\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.applyEffects()\r\n    this.think() //should set player's perception of world model via player's skills\r\n    this.takeAction()\r\n  }\r\n\r\n  assignRoleFromLineup(lineupPosition) {\r\n    if (lineupPosition) {\r\n      if (lineupPosition.indexOf('center') > -1) {\r\n        return 'Center'\r\n      } else if (lineupPosition.indexOf('left') > -1 || lineupPosition.indexOf('right') > -1) {\r\n        return 'Wing'\r\n      } else {\r\n        return 'Guard'\r\n      }\r\n    } else {\r\n      return undefined\r\n    }\r\n  }\r\n\r\n  applyEffects() {\r\n    // let's increase fatigue according to endurance stat\r\n    this.fatigue += (this.endurance / 100)\r\n    // high morale should equal a small netBuff\r\n    // high aggro should equal a small netBuff but also increase chance of injury\r\n  }\r\n\r\n  think() {\r\n    //we start with the real world model\r\n    const gameObjects = this.realWorldModel.objects\r\n    //we wipe away the player's old percieved world model\r\n    this.playerWorldModel.objects = []\r\n    this.playerWorldModel.leftPlayers = []\r\n    this.playerWorldModel.rightPlayers = []\r\n\r\n    // we will do calulcations here to modify based on Perception skill of this unique player's Perception attribute\r\n    // for now, let's assume this player is godlike and his perception is exactly the reality of the world\r\n\r\n    // player's perception of the pitch - what is the state of the game\r\n    const pitch = gameObjects[0]\r\n    this.playerWorldModel.objects.push(pitch)\r\n    // board probably isn't relevant to perception/reality, but we need it for the array order\r\n    const board = gameObjects[1]\r\n    this.playerWorldModel.objects.push(board)\r\n    // player's perception of the ball - where it's at, who has it, how close to goal\r\n    const ball = gameObjects[2]\r\n    this.playerWorldModel.objects.push(ball)\r\n    // player's perception of other players\r\n    const leftPlayers = this.realWorldModel.leftPlayers\r\n    const rightPlayers = this.realWorldModel.rightPlayers\r\n    this.playerWorldModel.leftPlayers = leftPlayers\r\n    this.playerWorldModel.rightPlayers = rightPlayers\r\n\r\n    // now we have rebuilt the playerWorldModel the way this unique player interprets it, hopefuly granting more agency for his/her actions\r\n  }\r\n\r\n  takeAction() {\r\n    const gameObjects = this.playerWorldModel.objects\r\n    const pitch = gameObjects[0]\r\n    const board = gameObjects[1]\r\n    const ball = gameObjects[2]\r\n    if (pitch.state === 'before_kickoff') {\r\n      // we are before kickoff so player wants to get the ball\r\n      this.tryTackleBall()\r\n      return\r\n    }\r\n    if (pitch.state === 'play_on' && ball.possessedBy === this.shockballPlayerUid) {\r\n      // this player has the ball - better trying priority 1 action first!\r\n      // player looks to score first, if he's in range.\r\n      // for now the goal is empty and it has a default resistence of 2\r\n      // for now the goalPosition (default 5) minus the goalProximity must be less than the goal resistence (default 2)\r\n      const thinksHasScoreChance = this.analyzeCanScore(ball, pitch)\r\n      if (thinksHasScoreChance) {\r\n        this.tryScore(pitch, board, ball)\r\n        return\r\n      } else {\r\n        // so he doesn't think he can score, so now move to priority 2 action - getting ball closer to scoring via pass or run\r\n        // for now this player thinks \"if my throwing + passing is lower than my toughness then I'll run.  otherwise I'll pass\"\r\n        const thinksCanPass = this.analyzeCanPass()\r\n        if (thinksCanPass) {\r\n          this.tryPass()\r\n          return\r\n        } else {\r\n          this.tryRun(pitch, ball)\r\n          return\r\n        }\r\n      }\r\n    } else if (pitch.state === 'play_on' && ball.possessedBy !== null && ball.lastSideTouched === this.homeGoalSide) {\r\n      // Ball is being carried by a player of my team\r\n    } else if (pitch.state === 'play_on' && ball.possessedBy !== null && ball.lastSideTouched !== this.homeGoalSide) {\r\n      // Ball is being carried by a player of other team\r\n\r\n      let thinksMoreLikelyToShoot = null\r\n      let actionGuess = null\r\n      if (this.homeGoalSide === 'right') {\r\n        //Player first decides: will ball handler throw or run?\r\n        actionGuess = this.analyzeNextAction(this.playerWorldModel.leftPlayers, ball)\r\n        if (actionGuess === 'throw') {\r\n          //Player now checks if more likely to shoot or pass\r\n          thinksMoreLikelyToShoot = this.analyzeMoreLikelyToShoot(this.playerWorldModel.leftPlayers, ball)\r\n          if (thinksMoreLikelyToShoot) {\r\n            this.tryBlockShot()\r\n          } else {\r\n            this.tryBlockPass()\r\n          }\r\n        } else {\r\n          this.tryTacklePlayer()\r\n        }\r\n      } else {\r\n        //Player first decides: will ball handler throw or run?\r\n        actionGuess = this.analyzeNextAction(this.playerWorldModel.rightPlayers, ball)\r\n        if (actionGuess === 'throw') {\r\n          //Player now checks if more likely to shoot or pass\r\n          thinksMoreLikelyToShoot = this.analyzeMoreLikelyToShoot(this.playerWorldModel.rightPlayers, ball)\r\n          if (thinksMoreLikelyToShoot) {\r\n            this.tryBlockShot()\r\n          } else {\r\n            this.tryBlockPass()\r\n          }\r\n        } else {\r\n          this.tryTacklePlayer()\r\n        }\r\n      }\r\n    } else if (pitch.state === 'play_on' && ball.possessedBy === null) {\r\n      console.log('ball has been fumbled and is free');\r\n      this.tryTackleBall()\r\n      // Ball is has been fumbled during play and is free\r\n    }\r\n  }\r\n\r\n  analyzeNextAction(opposingPlayers, ball) {\r\n    const ballCarrier = opposingPlayers.find(function(player) {\r\n      return player.shockballPlayerUid === ball.possessedBy\r\n    })\r\n    if (ballCarrier.throwing + ballCarrier.passing > ballCarrier.toughness + chance.rpg('1d12', {sum:true})) {\r\n      return 'throw'\r\n    } else {\r\n      return 'run'\r\n    }\r\n  }\r\n\r\n  analyzeMoreLikelyToShoot(players, ball) {\r\n    const ballCarrier = players.find(function(player) {\r\n      return player.shockballPlayerUid === ball.possessedBy\r\n    })\r\n    //simple determinatin right now - if throwing higher than passing, then this player assumes they'll shoot\r\n    if (ballCarrier && ballCarrier.throwing > ballCarrier.passing) {\r\n      return true\r\n    } else {\r\n      return false\r\n    }\r\n  }\r\n\r\n  analyzeCanScore(ball, pitch) {\r\n    const targetGoalResistence = pitch.goalResistence[this.homeGoalSide]\r\n    if (this.homeGoalSide === 'left') {\r\n      if (pitch.goalPit.right - ball.goalProximity < targetGoalResistence) {\r\n        return true\r\n      } else {\r\n        return false\r\n      }\r\n    } else if (this.homeGoalSide === 'right') {\r\n      if (Math.abs(pitch.goalPit.left - ball.goalProximity) < targetGoalResistence) {\r\n        return true\r\n      } else {\r\n        return false\r\n      }\r\n    }\r\n  }\r\n\r\n  analyzeCanPass() {\r\n    if (this.throwing + this.passing > this.toughness + chance.rpg('1d12', {sum:true})) {\r\n      return true\r\n    } else {\r\n      return false\r\n    }\r\n  }\r\n\r\n  tryScore(pitch, board, ball) {\r\n    this.challenge.addTryScore(this)\r\n  }\r\n\r\n  tryPass() {\r\n    this.challenge.addTryPass(this)\r\n  }\r\n\r\n  tryRun(pitch, ball) {\r\n    this.challenge.addTryRun(this)\r\n  }\r\n\r\n  tryTackleBall() {\r\n    this.challenge.addTackleBall(this)\r\n  }\r\n\r\n  tryTacklePlayer() {\r\n    this.challenge.addTryTacklePlayer(this)\r\n  }\r\n\r\n  tryBlockPass() {\r\n    this.challenge.addTryPass(this)\r\n  }\r\n\r\n  tryBlockShot() {\r\n    this.challenge.addTryScore(this)\r\n  }\r\n\r\n}"]}